<!--
* Licensed to the Apache Software Foundation (ASF) under one
* or more contributor license agreements.  See the NOTICE file
* distributed with this work for additional information
* regarding copyright ownership.  The ASF licenses this file
* to you under the Apache License, Version 2.0 (the
* "License"); you may not use this file except in compliance
* with the License.  You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
-->

<div ng-controller="CubeCtrl" class="nav-tabs-custom" style="margin-top:40px;">
    <ul class="nav nav-tabs">
        <li class="{{(!cubesManager.currentCube.visiblePage || cubesManager.currentCube.visiblePage=='metadata')? 'active':''}}">
            <a href="" ng-click="cubesManager.currentCube.visiblePage='metadata'">Grid</a>
        </li>
        <!--<li class="{{cubesManager.currentCube.visiblePage=='graph'? 'active':''}}">-->
            <!--<a href="" ng-click="cubesManager.currentCube.visiblePage='graph';buildGraph(cubesManager.currentCube);">Visualization</a>-->
        <!--</li>-->
        <li class="{{cubesManager.currentCube.visiblePage=='sql'? 'active':''}}">
            <a href="" ng-click="cubesManager.currentCube.visiblePage='sql';getCubeSql(cubesManager.currentCube)">SQL</a>
        </li>
        <li class="{{cubesManager.currentCube.visiblePage=='json'? 'active':''}}"
            ng-if="userService.hasRole('ROLE_ADMIN') || hasPermission(cubesManager.currentCube, 16) && !newAccess">
            <a href="" ng-click="cubesManager.currentCube.visiblePage='json';">JSON(Cube)</a>
        </li>
      <!--<li class="{{cubesManager.currentCube.visiblePage=='json_model'? 'active':''}}"-->
          <!--ng-if="userService.hasRole('ROLE_ADMIN') || hasPermission(cube, 16) && !newAccess">-->
        <!--<a href="" ng-click="cubesManager.currentCube.visiblePage='json_model';">JSON(Model)</a>-->
      <!--</li>-->
        <li class="{{cubesManager.currentCube.visiblePage=='access'? 'active':''}}">
            <a href="" ng-click="cubesManager.currentCube.visiblePage='access';listAccess(cubesManager.currentCube, 'CubeInstance');">Access</a>
        </li>
        <li class="{{cubesManager.currentCube.visiblePage=='notification'? 'active':''}}"
            ng-if="userService.hasRole('ROLE_ADMIN') || hasPermission(cubesManager.currentCube, 16) && !newAccess">
            <a href="" ng-click="cubesManager.currentCube.visiblePage='notification';getNotifyListString(cubesManager.currentCube);">Notification</a>
        </li>
        <li class="{{cubesManager.currentCube.visiblePage=='hbase'? 'active':''}}"
            ng-if="userService.hasRole('ROLE_ADMIN')">
            <a href="" ng-click="cubesManager.currentCube.visiblePage='hbase';getHbaseInfo(cubesManager.currentCube)">HBase</a>
        </li>
        <li class="dropdown" ng-if="userService.hasRole('ROLE_ADMIN') || hasPermission(cubesManager.currentCube, permissions.ADMINISTRATION.mask, permissions.MANAGEMENT.mask, permissions.OPERATION.mask)">
            <a class="dropdown-toggle highlight-bule" data-toggle="dropdown" href="#" aria-expanded="true">
                <i class="fa fa-cubes">Action</i> <span class="caret"></span>
            </a>
            <ul class="dropdown-menu">
                <li ng-if="cubesManager.currentCube.status=='DISABLED' && userService.hasRole('ROLE_ADMIN') ">
                    <a ng-click="dropCube(cubesManager.currentCube)" tooltip="Drop the cube, related jobs and data permanently.">Drop</a></li>
                <li ng-if="cubesManager.currentCube.status=='DISABLED' && (userService.hasRole('ROLE_ADMIN') || hasPermission(cubesManager.currentCube, permissions.ADMINISTRATION.mask, permissions.MANAGEMENT.mask))">
                    <a href="cubes/edit/{{cubesManager.currentCube.name}}">Edit</a></li>
                <li><a ng-click="startJobSubmit(cubesManager.currentCube);">Build</a></li>
                <li><a ng-click="startRefresh(cubesManager.currentCube)">Refresh</a></li>
                <li><a ng-click="startMerge(cubesManager.currentCube)">Merge</a></li>
                <li ng-if="cubesManager.currentCube.status!='DISABLED'"><a ng-click="disable(cubesManager.currentCube)">Disable</a></li>
                <li ng-if="cubesManager.currentCube.status=='DISABLED'"><a ng-click="enable(cubesManager.currentCube)">Enable</a></li>
                <li ng-if="cubesManager.currentCube.status=='DISABLED'"><a ng-click="purge(cubesManager.currentCube)">Purge</a></li>
            </ul>
        </li>

    </ul>

    <div class="cube-detail" ng-if="!cubesManager.currentCube.visiblePage || cubesManager.currentCube.visiblePage=='metadata'">
        <div ng-include="'partials/cubes/cube_schema.html'" ng-controller="CubeSchemaCtrl"
             ng-init="state={mode:'view', cubeName:cubesManager.currentCube.name}"></div>
    </div>

    <div ng-show="cubesManager.currentCube.visiblePage=='sql'" class="cube-detail">
        <div ng-if="cubesManager.currentCube.sql">
            <pre style="background-color: white;border: 0px">{{cubesManager.currentCube.sql}}</pre>
        </div>

        <div ng-if="!cubesManager.currentCube.sql">
            <span calss="text-info">No SQL GENERATED.</span>
        </div>
    </div>

    <div ng-show="cubesManager.currentCube.visiblePage=='json'" class="cube-detail">
        <pre ng-if="!state.jsonEdit"
             style="background-color: white;border: 0px">{{angular.toJson(cleanStatus(cubesManager.currentCube.detail), true)}}</pre>
    </div>

    <!--<div ng-show="cubesManager.currentCube.visiblePage=='json_model'" class="cube-detail">-->
          <!--<pre ng-if="!state.jsonEdit"-->
               <!--style="background-color: white;border: 0px">{{angular.toJson(cleanStatus(model), true)}}</pre>-->
    <!--</div>-->
    <!--<div ng-show="cubesManager.currentCube.visiblePage=='graph'" id="cube_graph_{{cubesManager.currentCube.name}}" class="cube-detail cube_graph">-->
    <!--</div>-->

    <div class="cube-detail" ng-if="cubesManager.currentCube.visiblePage=='access'">
        <div class="row">
            <div class="col-xs-1"></div>
            <div class="col-xs-10">
                <div ng-include src="'partials/common/access.html'" ng-init="entity=cubesManager.currentCube;type='CubeInstance';"></div>
            </div>
            <div class="col-xs-1"></div>
        </div>
    </div>

    <div class="cube-detail" ng-show="cubesManager.currentCube.visiblePage=='notification'">
        <div style="margin: 15px;">
            <form>
                <h5>Notification List(Common Separated)</h5>
                <div class="form-group">
                    <input ng-model="cubesManager.currentCube.notifyListString" class="form-control" placeholder="Notification List..." />
                </div>
                <div class="form-group">
                    <button class="btn btn-primary btn-sm" ng-click="updateNotifyList(cubesManager.currentCube)">Save</button>
                </div>
                <div class="space-4"></div>
            </form>
        </div>
    </div>

    <div class="cube-detail" ng-show="cubesManager.currentCube.visiblePage=='hbase'">
        <div style="margin: 15px;">
            <div ng-repeat="table in cubesManager.currentCube.hbase">
                <h5><b>HTable:</b> {{table.tableName}}</h5>
                <ul>
                    <li>Region Count: <span class="red">{{table.regionCount}}</span></li>
                    <li>Size: <span class="red">{{table.tableSize | bytes:2}}</span></li>
                    <li>Start Time: <span class="red">{{table.dateRangeStart | reverseToGMT0}}</span></li>
                    <li>End Time: <span class="red">{{table.dateRangeEnd | reverseToGMT0}}</span></li>
                </ul>
            </div>
            <div ng-if="cubesManager.currentCube.hbase">
                <div class="hr hr8 hr-double hr-dotted"></div>
                <h5><b>Total Size:</b> <span class="red">{{cubesManager.currentCube.totalSize | bytes:2}}</span></h5>
            </div>
            <div ng-if="cubesManager.currentCube.hbase.length == 0">
                <h5>No HBase Info.</h5>
            </div>
        </div>
    </div>
</div>
